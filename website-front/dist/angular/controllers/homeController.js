/*
 AugustoLemble 2016-01-14 
*/
angular.module("ALapp.controllers").controller("homeController",["$scope","$window","publicService","sessionService","$routeParams","$location","$sce",function(a,b,c,d,e,f,g){console.log("homeController init"),a.posts=[],a.words=d.getStrings(),a.language=a.words.language,a.findBy={},a.page=0,e.page&&-1!=e.page&&(a.page=e.page),e.title&&(a.findBy.titleEn={$regex:e.title,$options:"i"},a.findBy.titleEs={$regex:e.title,$options:"i"}),e.month&&e.year&&parseInt(e.month)<13&&parseInt(e.month)>0&&parseInt(e.year)>2013&&(a.findBy.date={$lt:new Date(e.year+","+e.month+",31"),$gt:new Date(e.year+","+(parseInt(e.month)-1)+",31")}),e.categories&&(a.findBy.categories={$in:e.categories.split(",")}),a.loading=!0,c.getPosts(a.findBy,10*a.page,"-date").then(function(b){if(b.data.success){a.posts=b.data.posts;for(var c=0;c<a.posts.length;c++)a.posts[c].bodyEs=a.posts[c].bodyEs.replace(/<img .*?>/g,""),a.posts[c].bodyEn=a.posts[c].bodyEn.replace(/<img .*?>/g,"");b.data.lastPage&&(a.page=b.data.lastPage,e.page=b.data.lastPage)}a.loading=!1}),a.goPage=function(b){switch(b){case"previous":e.page=parseInt(a.page)-1;break;case"first":e.page=0;break;case"next":e.page=parseInt(a.page)+1;break;case"last":e.page=-1}f.search(e)},a.goPost=function(a){b.location.assign("/post?id="+a)},a.toTrusted=function(a){return g.trustAsHtml(a)}}]);